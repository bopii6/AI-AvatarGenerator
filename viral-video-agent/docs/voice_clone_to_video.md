# 桌面端：声音克隆 → 生成口播数字人视频（完整跑通）

## 0. 你需要准备什么
- 云端数字人服务（Duix）：对外端口 `8383`
- 阿里云 DashScope API Key（CosyVoice-v3）
- 桌面端 `.env` 里配置好云端公网 IP + DashScope Key

桌面端 `.env` 示例：
```env
CLOUD_GPU_SERVER_URL=http://<GPU服务器公网IP>
CLOUD_GPU_VIDEO_PORT=8383

ALIYUN_DASHSCOPE_API_KEY=
ALIYUN_COSYVOICE_MODEL=cosyvoice-v3-flash
```

云端部署参考：
- `scripts/deploy/README.md`
- 服务器回收后的恢复：`scripts/deploy/RECOVERY_SOP.md`

---

## 1. 第一次：训练/克隆你的声音
1) 打开桌面端 → 右上角「设置」
2) 进入「声音克隆」
3) 点击「开始录音」并连续说话 30–90 秒 → 点击「停止录音」
4) 填一个名称 → 点「创建音色」
5) 等状态变成 `ready`（训练完成后会出现在列表）

提示：
- 如果提示“DashScope 未连接”，先在「设置 → 语音 API」中填入 `ALIYUN_DASHSCOPE_API_KEY` 并保存验证。

---

## 2. 生成口播音频（用克隆声音）
1) 进入「音频生成」
2) 选择「克隆我的声音」
3) 在下拉框选择刚训练好的声音模型（状态 `ready`）
4) 点击「生成音频」
5) 生成成功后会出现试听播放器，并提供「下一步：生成口播数字人分身」按钮

你也可以先用「预置音色」跑通流程（不用训练）。

---

## 3. 创建数字人形象（只做一次，后续复用）
1) 进入「口播数字人分身」
2) 如果还没有形象：点击「创建新形象」
3) 上传一段你的自拍视频（建议 10–30 秒、正脸清晰、光线充足）
4) 保存后会出现在形象列表，后续可直接复用

提示：
- 如果提示“云端服务器未连接”，检查 `.env` 的 `CLOUD_GPU_SERVER_URL` / `CLOUD_GPU_VIDEO_PORT`，以及安全组是否放通 `8383`。

---

## 4. 生成口播数字人视频
1) 在「口播数字人分身」里选中一个形象
2) 确认「准备音频」已就绪（你在第 2 步生成的音频）
3) 点击「一键生成口播分身视频」
4) 等进度条完成后，出现视频结果
5) 点击「下载到桌面」即可把 mp4 保存到你的桌面

---

## 5. 常见问题
### 5.1 音频生成成功，但视频生成按钮是灰色
需要同时满足：
- 已选择一个形象
- 已生成音频
- 云端 Duix 服务在线（8383 可访问）

### 5.2 声音克隆/配音失败
- 确认已配置并验证 `ALIYUN_DASHSCOPE_API_KEY`
- 确认 DashScope 账户余额/配额正常
